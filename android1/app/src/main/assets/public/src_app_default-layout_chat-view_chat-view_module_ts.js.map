{"version":3,"file":"src_app_default-layout_chat-view_chat-view_module_ts.js","mappings":"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","sources":["./src/app/default-layout/chat-view/chat-view-routing.module.ts","./src/app/default-layout/chat-view/chat-view.module.ts","./src/app/default-layout/chat-view/chat-view.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ChatViewPage } from './chat-view.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ChatViewPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ChatViewPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ChatViewPageRoutingModule } from './chat-view-routing.module';\n\nimport { ChatViewPage } from './chat-view.page';\nimport { SharedModule } from 'src/app/shared/shared.module';\nimport { UploadService } from 'src/app/service/upload/upload.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    IonicModule,\n    ChatViewPageRoutingModule,\n    SharedModule\n  ],\n  declarations: [ChatViewPage],\n  providers: [ UploadService],\n})\nexport class ChatViewPageModule {}\n","import { Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { TranslateService } from '@ngx-translate/core';\nimport { ChatService } from 'src/app/service/chat/chat.service';\nimport { StorageService, ToastService } from 'src/app/core/services';\nimport { LoaderService } from 'src/app/core/services/loader.service';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { IonInfiniteScroll } from '@ionic/angular';\nimport { Socket } from 'ngx-socket-io';\nimport { UploadService } from 'src/app/service/upload/upload.service';\nconst { App, Geolocation } = Plugins;\nimport { Plugins, FilesystemDirectory } from '@capacitor/core';\nconst { Filesystem } = Plugins;\n\n@Component({\n  selector: 'app-chat-view',\n  templateUrl: './chat-view.page.html',\n  styleUrls: ['./chat-view.page.scss'],\n})\nexport class ChatViewPage implements OnInit, OnDestroy {\n  @ViewChild(IonInfiniteScroll, { static: false })\n  infiniteScroll: IonInfiniteScroll;\n  disabledScroll = false;\n  page: number = 1;\n  pageSize: number = 10;\n  search = '';\n  shopId: number;\n  msgArr: any = [];\n  user: any = {};\n  msg: any = '';\n  customerId: number;\n  message: string = '';\n  shopName: string = '';\n  roomName: string = '';\n  userId: number;\n  fileUploaded: boolean = false;\n  filePath: string = '';\n  data: any = {};\n\n  constructor(\n    private activatedRoute: ActivatedRoute,\n    private router:Router,\n    public translate: TranslateService,\n    private chatService: ChatService,\n    private toaster: ToastService,\n    private spinner: LoaderService,\n    private localStorage: StorageService,\n    private uploadService: UploadService,\n    private socket: Socket\n  ) {}\n\n  chatForm = new FormGroup({\n    _id: new FormControl(),\n    roomName: new FormControl(''),\n    message: new FormControl('',[Validators.required]),\n    createdBy: new FormControl(),\n    image: new FormControl(''),\n  });\n\n  ngOnInit() {}\n  ionViewWillEnter() {\n    this.user = this.localStorage.get('OBCustomer');\n    this.activatedRoute.queryParams.subscribe((params) => {\n      if (params.shopId) {\n        this.shopId = params.shopId;\n      }\n      if (params.shopName) this.shopName = params.shopName;\n      if (params.roomName) this.roomName = params.roomName;\n      this.getMsgByCustomerId(false);\n    });\n\n    // socket\n    this.socket.on(\n      'latest',\n      function (data: any) {\n        console.log(data);\n        console.log('latest-data called in shopApp@@@@');\n        this.getMsgByCustomerId(false);\n      }.bind(this)\n    );\n  }\n\n  ngOnDestroy(): void {\n    console.log('destroy');\n    this.socket.disconnect();\n  }\n\n  sendMessage() {\n    this.chatForm.controls.roomName.setValue(this.roomName);\n    this.chatService.create(this.chatForm.value).subscribe(\n      (success) => {\n        this.getMsgByCustomerId(false);\n        // emit\n        this.socket.emit('latestdata', {\n          roomName: this.roomName,\n          userId: this.user._id,\n          data: this.chatForm.value,\n        });\n        this.chatForm.reset();\n        this.spinner.hideLoader();\n      },\n      (error: any) => {\n        this.spinner.hideLoader();\n        this.toaster.errorToast(error);\n      }\n    );\n  }\n\n  getMsgByCustomerId(isFirstLoad: boolean, event?: any) {\n    this.spinner.showLoader();\n    this.chatService\n      .getMsgByCustomerId(this.roomName)\n      .subscribe((success: any) => {\n        this.msgArr = success.payload.rows;\n        this.spinner.hideLoader();\n      });\n  }\n\n  async uploadFileAWS($event) {\n    let file = $event.target.files[0];\n    await this.spinner.showLoader();\n    let formData = new FormData();\n    formData.append('file', file);\n    this.uploadService.uploadFile(formData).subscribe(\n      async (data: any) => {\n        this.filePath = data?.result?.url;\n        this.chatForm.controls.image.setValue(this.filePath);\n        this.fileUploaded = true;\n        await this.spinner.hideLoader();\n        this.sendMessage();\n      },\n      async (error: any) => {\n        await this.spinner.hideLoader();\n        this.toaster.errorToast(error);\n      }\n    );\n  }\n\n  doInfinite(event) {\n    this.page++;\n    this.getMsgByCustomerId(true, event);\n    event.target.disabled = true;\n    this.infiniteScroll.disabled = true;\n    event.target.complete();\n  }\n\n  downloadImage(message) {\n    this.spinner.showLoader();\n    this.uploadService\n      .downloadImage(message.image)\n      .subscribe(async (success: any) => {\n        this.toaster.successToast(\n          'Image Downloaded successfully. Please check your Documents folder.'\n        );\n        await Filesystem.writeFile({\n          path: `${message.image.split('post/')[1]}`,\n          data: success.result.src as string,\n          directory: FilesystemDirectory.Documents,\n        });\n        this.spinner.hideLoader();\n      });\n  }\n\n  // location share\n  async locationShare() {\n    let geoLocation = await (await Geolocation.getCurrentPosition()).coords;\n    console.log('geoLocation', geoLocation);\n    let msg = `http://maps.google.com/?ie=UTF8&hq=&ll=${geoLocation.latitude},${geoLocation.longitude}&z=18`;\n    this.chatForm.controls.message.setValue(msg);\n    this.sendMessage();\n  }\n  async openUrl(url) {\n    console.log(url.includes('http'), 'url', url);\n    if (!url.includes('http')) {\n      return;\n    }\n    let ret = await App.openUrl({\n      url: url,\n    });\n  }\n\n  doRefresh(event: any) {\n    this.msgArr = [];\n    this.getMsgByCustomerId(false, '');\n    event.target.complete();\n  }\n\n  confirmOrder() {\n    this.chatForm.controls.message.setValue('Confirm Order 👍');\n    this.sendMessage();\n  }\n\n\n  navigateTo(shopId){\n    this.router.navigate(['/shop-detail'], {\n      queryParams: {\n        shopId: this.shopId,\n     },\n    }); \n  }\n}\n"],"names":["Component","ViewChild","ActivatedRoute","Router","TranslateService","ChatService","StorageService","ToastService","LoaderService","FormGroup","FormControl","Validators","IonInfiniteScroll","Socket","UploadService","App","Geolocation","Plugins","FilesystemDirectory","Filesystem","ChatViewPage","constructor","activatedRoute","router","translate","chatService","toaster","spinner","localStorage","uploadService","socket","_id","roomName","message","required","createdBy","image","ngOnInit","ionViewWillEnter","user","get","queryParams","subscribe","params","shopId","shopName","getMsgByCustomerId","on","data","console","log","bind","ngOnDestroy","disconnect","sendMessage","chatForm","controls","setValue","create","value","success","emit","userId","reset","hideLoader","error","errorToast","isFirstLoad","event","showLoader","msgArr","payload","rows","uploadFileAWS","$event","file","target","files","formData","FormData","append","uploadFile","filePath","result","url","fileUploaded","doInfinite","page","disabled","infiniteScroll","complete","downloadImage","successToast","writeFile","path","split","src","directory","Documents","locationShare","geoLocation","getCurrentPosition","coords","msg","latitude","longitude","openUrl","includes","ret","doRefresh","confirmOrder","navigateTo","navigate","args","static","selector","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}